// This is a manifest file that'll be compiled into application.js, which will include all the files
// listed below.
//
// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,
// or vendor/assets/javascripts of plugins, if any, can be referenced here using a relative path.
//
// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
// compiled file.
//
// Read Sprockets README (https://github.com/sstephenson/sprockets#sprockets-directives) for details
// about supported directives.
//
//= require jquery
//= require jquery_ujs
//= require_tree .

/***********************************************************************************************************************
/ Main
/**********************************************************************************************************************/

var loaders, pages;

var currentUser = null, favorites = [];
var users = null;
var global_info = null;
var filter_settings = {
    category: {label: 'Categories', value: null},
    subcategory: {label: 'Subcategories', value: null},
    city: {label: 'City', value: null},
    college: {label: 'College', value: null},
    hourly_rate_from: {label: '0', value: 0},
    hourly_rate_to: {label: '200', value: 200},
    rate_from: {label: '0', value: 0},
    rate_to: {label: '5', value: 5},
    subcategories: []
}

$(window).on('load', function () {

    pages = {

        'active': '',

        'home': {

            'href': '',
            'load': function () {
                $('#presentation').css({ opacity: 0, display: 'block' }).animate({ opacity: 1 }, 1000, 'linear');

                $('#background').removeClass('disabled');
                $('#admin-panel').removeClass('disabled');

                rF = {

                    /* Name, email, zip fields and send button. */

                    'href': '/presentation/subscribe',

                    'n': $('#register-form-name'),
                    'e': $('#register-form-email'),
                    'z': $('#register-form-zip')

                };

                cF = $('#contact-form');
                cF = {

                    /* Name, email, phone number, reason for contact, message fields and contact button. */

                    'href': '/send_message',

                    'n': cF.find('.name'),
                    'e': cF.find('.email'),
                    'p': cF.find('.phone'),
                    's': cF.find('.reason'),
                    'm': cF.find('.message')

                };

            }

        },

        'login': {

            'href': '/login',
            'load': function () {

                sF = $('#sign-in');
                sF = {

                    'href': '/user/signin',

                    'email': sF.find('.email'),
                    'password': sF.find('.password')

                };

                $('#presentation').animate({ opacity: 0 }, 1000, 'linear').promise().done(function () { $('#presentation').css({ display: 'none' }); });

                $('#background').addClass('disabled');
                $('#admin-panel').addClass('disabled');

            }

        },

        'signup': {

            'href': '/signup',
            'load': function () {

                if ($('#admin-panel')) {
                    $('#admin-panel').addClass('disabled');
                }
                if ($('#background')) {
                    $('#background').addClass('disabled');
                }

                sF = $('#sign-up-form');
                sF = {

                    'href': '/user/signup',

                    'a': sF.find('.image-upload #avatar'),

                    'n': sF.find('.name'),
                    'e': sF.find('.email'),
                    'p': sF.find('.password'),
                    'pc': sF.find('.password_confirmation'),
                    'as': false
                }

                sF.a.on('change', function () {
                    sF.as = true;
                });
            }

        },

        'signup_service_provider': {
            'href': '/signup_service_provider',
            'load': function () {
                if ($('#admin-panel')) {
                    $('#admin-panel').addClass('disabled');
                }
                if ($('#background')) {
                    $('#background').addClass('disabled').css('overflow-y', 'scroll');;
                }

                sF = $('#sign-up-sp-form');
                sF = {

                    'href': '/user/set_details',

                    'street': sF.find('.street'),
                    'state': sF.find('#state_id'),
                    'zip': sF.find('.zip'),
                    'description': sF.find('.desc'),
                    'summary': sF.find('.summary'),
                    'hourly_rate': sF.find('.hourly_rate'),
                    'experience': sF.find('.experience')

                };

                $.ajax({
                    url: 'http://backend.liquidtalent.com/get_info',
                    error: function (error) {
                        alert("Problem with connecting to the server");
                        console.log(error);
                    }
                }).done(function (data) {
                            data['response']['cities'].forEach(function (item) {
                                $('#cities').append('<div onclick="setCity(' + item['id'] + ', \'' + item['name'] + '\');">' + item['name'] + '</div>')
                            })

                            data['response']['categories'].forEach(function (item) {
                                $('#skills').append('<div onclick="setSkills(' + item['id'] + ', \'' + item['name'] + '\');">' + item['name'] + '</div>')
                            })
                });

                Object.keys(states).forEach(function (key) {
                    $('#states').append('<div onclick="setState(\'' + states[key] + '\', \'' + key + '\');">' + key + '</div>')
                })

                $('.city').click(function () {
                    $('#cities').show();
                });

                $('.skills').click(function () {
                    $('#skills').show();
                });

                $('.state').click(function () {
                    $('#states').show();
                });
            }
        },

        'search': {

            'href': '/search',
            'load': function () {

                if ($('#admin-panel')) { $('#admin-panel').removeClass('disabled'); }
                if ($('#background')) { $('#background').removeClass('disabled').css('overflow-y', 'scroll'); }

                if(users == null) {
                    filterUsers(listSearch);
                }
                else {
                    listSearch(users);
                }

                prepareFilter();
            }

        },

        'map': {

            'href': '/map',
            'load': function () {

                $('#presentation').animate({ opacity: 0 }, 1000, 'linear').promise().done(function () {
                    $('#presentation').css({ display: 'none' });
                });

                if ($('#background.disabled')) { $('#background').removeClass('disabled'); }
                if ($('#admin-panel.disabled')) { $('#admin-panel').removeClass('disabled'); }

                map = $('#map-overlay');
                map = {

                    'markers': [],

                    'googleMap': new google.maps.Map( document.getElementById('map'), {
                        center: new google.maps.LatLng(40.5403, -73.5463),
                        zoom: 8,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    }),

                    'popUp': {
                        'overlay': $('#map-overlay'),
                        'image': map.find('.avatar'),
                        'description': map.find('.description'),
                        'distance': map.find('.distance'),
                        'linkedIn': map.find('.linkedin-icon'),
                        'title': map.find('.base .title'),
                        'favorite': map.find('.favorite-button'),
                        'play': map.find('.play-button'),
                        'LTDrop': map.find('.lt-drop'),
                        'stars': map.find('.stars .star')
                    }

                };

                map.popUp.overlay.on('click', function (event) {
                    if ($(event.target).prop('id') === 'map-overlay') {
                        map.popUp.overlay.animate({ opacity: 0 }, 1000, 'linear').promise().done(function () {
                            map.popUp.overlay.css('display', 'none');
                        });
                    }
                });

                if (users === null) { filterUsers(mapSearch); }
                else { mapSearch(users); }

                prepareFilter();
            }

        }

    };

    loaders = {

        'tags': $('.loader'),

        'toggle': function (loader, opacity) {

            loader = loaders.tags.each(function () {

                if ($(this).prop('alt') === loader) {
                    return $(this);
                }

            });
            loader.animate({ 'opacity': opacity }, 1000, 'linear');

        }

    };

    states = {
        'Alabama': 'AL',
        'Alaska': 'AK',
        'Arizona': 'AZ',
        'Arkansas': 'AR',
        'California': 'CA',
        'Colorado': 'CO',
        'Connecticut': 'CT',
        'Delaware': 'DE',
        'District Of Columbia': 'DC',
        'Florida': 'FL',
        'Georgia': 'GA',
        'Hawaii': 'HI',
        'Idaho': 'ID',
        'Illinois': 'IL',
        'Indiana': 'IN',
        'Iowa': 'IA',
        'Kansas': 'KS',
        'Kentucky': 'KY',
        'Louisiana': 'LA',
        'Maine': 'ME',
        'Maryland': 'MD',
        'Massachusetts': 'MA',
        'Michigan': 'MI',
        'Minnesota': 'MN',
        'Mississippi': 'MS',
        'Missouri': 'MO',
        'Montana': 'MT',
        'Nebraska': 'NE',
        'Nevada': 'NV',
        'New Hampshire': 'NH',
        'New Jersey': 'NJ',
        'New Mexico': 'NM',
        'New York': 'NY',
        'North Carolina': 'NC',
        'North Dakota': 'ND',
        'Ohio': 'OH',
        'Oklahoma': 'OK',
        'Oregon': 'OR',
        'Pennsylvania': 'PA',
        'Rhode Island': 'RI',
        'South Carolina': 'SC',
        'South Dakota': 'SD',
        'Tennessee': 'TN',
        'Texas': 'TX',
        'Utah': 'UT',
        'Vermont': 'VT',
        'Virginia': 'VA',
        'Washington': 'WA',
        'West Virginia': 'WV',
        'Wisconsin': 'WI',
        'Wyoming': 'WY',
        'American Samoa': 'AS',
        'Guam': 'GU',
        'Northern Mariana Islands': 'MP',
        'Puerto Rico': 'PR',
        'United States Minor Outlying Islands': 'UM',
        'Virgin Islands': 'VI',
        'Armed Forces Americas': 'AA',
        'Armed Forces Pacific': 'AP',
        'Armed Forces Others': 'AE'
    }

    pages.home.load();

});

function Response(response) {

    if (response['error'] && response['error'] != '') {
        alert(response['error']);
    }
    else if (response['success']) {
        alert(response['success']);
    }
    else {

        alert("Could not connect to the server. Please try again later.");
        console.log(response);

    }

}

function loadPage(page) {
    $('#content-preloader').show();

    Object.keys(pages).forEach(function (p) {
        if (pages[p].href === page.replace(/\?.+$/, '')) {
            pages.active = pages[p];
        }
    });

    $.ajax({
        url: page,
        error: Response
    }).done(function (data) {
        $('#content-preloader').hide();
        $('#background').html(data);
        pages.active.load();
    });

    return false;

}

function getURLParameter(name) {
    return (decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [, ""])[1]).replace(/\+/g, '%20')) || null;
}

/***********************************************************************************************************************
/ Presentation
/**********************************************************************************************************************/

var rF;
var cF;
var pageSegments;

function SubmitRegisterForm() {

    $.ajax({
        url: rF.href,
        type: 'post',
        data: 'name=' + rF.n.val() + '&email=' + rF.e.val() + '&zip=' + rF.z.val(),
        error: Response(data)
    }).done(Response(data));

}

function SubmitContactForm() {

    loaders.toggle('contact', 1);

    $.ajax({
        url: cF.href,
        type: 'post',
        data: 'name=' + cF.n.val() + '&email=' + cF.e.val() + '&phone=' + cF.p.val() + '&subject=' + cF.s.val() + '&message=' + cF.m.val(),
        error: Response(data)
    }).done(function (data) {
                Response(data);
                loaders.toggle('contact', 0);
            });

}

function RevealPage(pageSegment) {

    pageSegments = {

        about: $('#about-page'),
        press: $('#press-page'),
        contact: $('#contact-page'),
        privacy: $('#privacy-page')

    };

    if (pageSegment === 'privacy') {

        pageSegments.about.animate({ 'opacity': 0 }, 300, 'linear', function () {
            pageSegments.about.css('display', 'none');
        });
        pageSegments.press.animate({ 'opacity': 0 }, 300, 'linear', function () {
            pageSegments.press.css('display', 'none');
        });
        pageSegments.contact.animate({ 'opacity': 0 }, 300, 'linear', function () {
            pageSegments.contact.css('display', 'none');
        });

        pageSegments.privacy.css('display', 'block').animate({ 'opacity': 1 }, 300, 'linear', null);

    }
    else {

        pageSegments.privacy.animate({ 'opacity': 0 }, 300, 'linear', function () {
            pageSegments.privacy.css('display', 'none');
        });

        pageSegments.about.css('display', 'block').animate({ 'opacity': 1 }, 300, 'linear', null);
        pageSegments.press.css('display', 'block').animate({ 'opacity': 1 }, 300, 'linear', null);
        pageSegments.contact.css('display', 'block').animate({ 'opacity': 1 }, 300, 'linear', null);

    }

    $('html, body').delay(500).animate({ scrollTop: $(pageSegments[pageSegment]).offset().top }, 300, 'linear', null);

}

var sF;

/***********************************************************************************************************************
/ User
/**********************************************************************************************************************/

function login() {

    $('#preloader').show();

    $.ajax({
        url: 'http://backend.liquidtalent.com' + sF.href,
        data: 'email=' + sF.email.val() + '&password=' + sF.password.val()
    }).done(function (data) {

        if (data['status'] === 'failed') { alert(data['errors'][0]); }
        else {
            currentUser = data['response']['user'];
            showUserInfo();
            checkUnreadMessages();
            loadPage('/search');
        }

        $('#preloader').hide();

        getFavorites();

    });

}

/****** Search ******/

var sF;

/***********************************************************************************************************************
/ SignUp
/**********************************************************************************************************************/

function SubmitSignupForm() {
    $('#preloader').show();

    $.ajax({
        url: 'http://backend.liquidtalent.com' + sF.href,
        data: 'name=' + sF.n.val() + '&email=' + sF.e.val() + '&password=' + sF.p.val() + '&password_confirmation=' + sF.pc.val(),
        error: Response
    }).done(function (data) {
                if (data['status'] === 'failed') {
                    alert(data['errors'][0]);
                }
                else {
                    if (sF.as === true) {
                        $.ajax({
                            url: 'http://backend.liquidtalent.com/user/set_avatar',
                            type: 'POST',
                            contentType: false,
                            processData: false,
                            data: function () {
                                var rq_data = new FormData();
                                rq_data.append("user_id", data['response']['user']['id']);
                                rq_data.append("token", data['response']['user']['token']);
                                rq_data.append("avatar", sF.a.get(0).files[0]);
                                return rq_data;
                            }(),
                            error: Response
                        }).done(function (avatar_data) {
                                    if (avatar_data['status'] === 'failed') {
                                        alert(avatar_data['errors'][0]);
                                    }
                                    else {
                                        currentUser = data['response']['user'];
                                        currentUser['avatar_url'] = avatar_data['response']['url'];

                                        if ($('#is_provider').is(':checked')) {
                                            loadPage('/signup_service_provider?user_id=' + data['response']['user']['id'] + '&token=' + data['response']['user']['token']);
                                        }
                                        else {
                                            showUserInfo();
                                            checkUnreadMessages();
                                            loadPage('/map');
                                        }
                                    }

                                    $('#preloader').hide();
                                });

                    }
                    else {
                        if ($('#is_provider').is(':checked')) {
                            loadPage('/signup_service_provider?user_id=' + data['response']['user']['id'] + '&token=' + data['response']['user']['token']);
                        }
                        else {
                            currentUser = data['response']['user'];
                            showUserInfo();
                            checkUnreadMessages();
                            loadPage('/map');
                        }
                    }
                }

                $('#preloader').hide();
            });

    return false;

}

function SubmitSignupSPForm() {
    $('#preloader').show();

    $.ajax({
        url: 'http://backend.liquidtalent.com' + sF.href,
        data: 'user_id=' + $('#user_id').val() +
                '&token=' + $('#token').val() +
                '&attr[street]=' + sF.street.val() +
                '&attr[city_id]=' + $('#city_id').val() +
                '&attr[state]=' + sF.state.val() +
                '&attr[zip]=' + sF.zip.val() +
                '&attr[description]=' + sF.description.val() +
                '&attr[summary]=' + sF.summary.val() +
                '&attr[hourly_rate]=' + sF.hourly_rate.val() +
                '&attr[experience]=' + sF.experience.val() +
                '&attr[category_id]=' + $('#category_id').val() +
                '&attr[school_id]=' + $('#school_id').val() +
                '&attr[is_provider]=1',
        error: Response
    }).done(function (data) {
                if (data['status'] === 'failed') {
                    alert(data['errors'][0]);
                }
                else {
                    currentUser = data['response'];
                    showUserInfo();
                    checkUnreadMessages();
                    loadPage('/map');
                }

                $('#preloader').hide();
            });

}

function searchSchool(query) {

    if (query === '') {
        $('#schools').html('');
        return;
    }

    $.ajax({
        url: 'http://backend.liquidtalent.com/schools/search?search=' + query,
        error: Response
    }).done(function (data) {
                $('#schools').html('');
                data['response'].forEach(function (school) {
                    $('#schools').append('<div onclick="setSchool(' + school['_source']['id'] + ', \'' + school['_source']['name'] + '\');">' + school['_source']['name'] + '</div>')
                })
            });
}

function setCategory(id, name) {
    $('.category').val(name);
    $('#category_id').val(id);

    filter_settings.category.label = name;
    filter_settings.category.value = id;

    $('#categories').hide();

    $('.subcategory').val('Subcategories');
    $('#subcategories').html('');

    if(id == null) {
        $('#subcategory_id').val(null);
    }

    global_info['sub_categories'].forEach(function (item) {
        if(item['parent_id'] == id) {
            $('#subcategories').append('<div onclick="setSubcategory(' + item['id'] + ', \'' + item['name'] + '\');">' + item['name'] + '</div>');
            filter_settings.subcategories.push({label: item['name'], value: item['id']});
        }
    });
}

function setSubcategory(id, name) {
    $('.subcategory').val(name);
    $('#subcategory_id').val(id);

    filter_settings.subcategory.label = name;
    filter_settings.subcategory.value = id;

    $('#subcategories').hide();
}

function setCity(id, name) {
    $('.city').val(name);
    $('#city_id').val(id);

    filter_settings.city.label = name;
    filter_settings.city.value = id;

    $('#cities').hide();
}

function setSkills(id, name) {

    $('.skills').val(name);
    $('#category_id').val(id);

    $('#skills').hide();
}

function setState(id, name) {

    $('.state').val(name);
    $('#state_id').val(id);

    $('#states').html('');
}

function setSchool(id, name) {
    $('.school').val(name);
    $('#school_id').val(id);

    filter_settings.college.label = name;
    filter_settings.college.value = id;

    $('#schools').html('');
}

function show_user(user_id, callback) {
    $.ajax({
        url: 'http://backend.liquidtalent.com/user/show?user_id=' + user_id,
        error: Response
    }).done(function (data) {
                return callback(data);
            });
}

function linkedin_connect(access_token) {
    $.ajax({
        url: 'http://backend.liquidtalent.com/user/linkedin_connect/?access_token=' + access_token,
        error: function (error) {
            alert("Problem with connecting to the server.");
            console.log(error['']);
        }
    }).done(function (data) {
                if (data['response']['new_user']) {
                    if (confirm('Do you want to register as a Service Provider?')) {
                        loadPage('/signup_service_provider?user_id=' + data['response']['user']['id'] + '&token=' + data['response']['user']['token']);
                    } else {
                        currentUser = data['response']['user'];
                        showUserInfo();
                        checkUnreadMessages();
                        loadPage('/map');
                    }

                    $('#preloader').hide();
                }
                else {
                    currentUser = data['response']['user'];
                    showUserInfo();
                    checkUnreadMessages();
                    loadPage('/map');
                }

                $('#preloader').hide();
            });
}

/****** Search ******/

var map, states, list;

function mapSearch(providers) {
    map = $('#map-overlay');
    map = {

        'markers': [],

        'googleMap': new google.maps.Map( document.getElementById('map'), {
            center: new google.maps.LatLng(40.5403, -73.5463),
            zoom: 8,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }),

        'popUp': {
            'overlay': $('#map-overlay'),
            'image': map.find('.avatar'),
            'description': map.find('.description'),
            'distance': map.find('.distance'),
            'linkedIn': map.find('.linkedin-icon'),
            'title': map.find('.base .title'),
            'favorite': map.find('.favorite-button'),
            'play': map.find('.play-button'),
            'LTDrop': map.find('.lt-drop'),
            'stars': map.find('.stars .star')
        }

    };

    map.popUp.overlay.on('click', function (event) {
        if ($(event.target).prop('id') === 'map-overlay') {
            map.popUp.overlay.animate({ opacity: 0 }, 1000, 'linear').promise().done(function () {
                map.popUp.overlay.css('display', 'none');
            });
        }
    });

    $('#content-preloader').hide();

    providers.forEach(function (user) {

            map.markers[user.id] = new google.maps.Marker({

                position: new google.maps.LatLng(user.latitude, user.longitude),
                map: map.googleMap,
                title: user.name,
                icon: '<%= asset_path 'search/pin.png' %>'

            });

            google.maps.event.addListener(map.markers[user.id], 'click', function () {

                if (user.state !== undefined) { user.state = (user.state.length > 2)? states[user.state] : user.state.toUpperCase(); }
                else { user.state = 'NY'; }

                map.popUp.LTDrop.removeClass('hidden').removeClass('blue').removeClass('bronze').removeClass('silver').removeClass('gold');

                if (typeof (favorites[user.id]) === 'number') { map.popUp.favorite.addClass('active'); }
                else { map.popUp.favorite.removeClass('active'); }
                map.popUp.favorite.attr('onmousedown', 'createFavorite(' + user.id + ', $(this));');

                user.avatar_url = (user.avatar_url === null) ? '<%= asset_path 'main/avatar.png' %>' : user.avatar_url;

                if (user.badge_provider === 'no') { map.popUp.LTDrop.addClass('hidden'); }
                else { map.popUp.LTDrop.addClass(user.badge_provider); }

//                if (user.video_url === null) { map.popUp.play.addClass('disabled'); }
//                else { map.popUp.play.removeClass('disabled'); }

                map.popUp.stars.each(function (i, star) {

                    if (i < user.rate_provider) { $(star).addClass('active'); }
                    else { $(star).removeClass('active'); }

                });

                map.popUp.overlay.css('display', 'block').animate({ opacity: 1 }, 1000, 'linear');
                map.popUp.image.prop('src', user.avatar_url);
                map.popUp.description.html(user.description);
                map.popUp.title.html('<p class="name">' + user.name + '</p>' + user.city_name + ', ' + user.state);

                map.popUp.distance.html('$' + user.hourly_rate + '.00');

            });

        });

}

function listSearch(providers) {
    $('#providers').html('');

    providers.forEach(function (user) {

            if (user.state !== undefined) { user.state = (user.state.length > 2)? states[user.state] : user.state.toUpperCase(); }
            else { user.state = 'NY'; }

            user.avatar_url = (user.avatar_url === null) ? '<%= asset_path 'main/avatar.png' %>' : user.avatar_url;

            $('#first-item .avatar').attr('src', user.avatar_url);

            if (user.badge_provider === 'no') { $('#first-item .lt-drop').addClass('hidden'); }
            else { $('#first-item .lt-drop').addClass(user.badge_provider); }

//            if (user.video_url === null) { $('#first-item .play-button').addClass('disabled'); }
//            else { $('#first-item .play-button').removeClass('disabled'); }

            $('#first-item .title').html('<p class="name">' + user.name + '</p>' + user.city_name + ', ' + user.state);
            $('#first-item .description').html(user.description);

            $('#first-item .distance').html('$' + user.hourly_rate + '.00');

            if (typeof (favorites[user.id]) === 'number') { $('#first-item .favorite-button').addClass('active'); }
            else { $('#first-item .favorite-button').removeClass('active'); }
            $('#first-item .favorite-button').attr('onmousedown', 'createFavorite(' + user.id + ', $(this));');

            $('#providers').append('<div class="list-item">' + $('#first-item').clone().html() + '</div>');

        });
}

function checkUnreadMessages() {

    $.ajax({
        url: 'http://backend.liquidtalent.com/messages/list?limit=9999&receiver_id=' + currentUser['id'],
        error: Response
    }).done(function (data) {
                $('.navigation .messages').html('<div style="position: absolute; right: 10px;">' + data['response'].length + '</div>');
            });

    setTimeout('checkUnreadMessages()', 10000);

}

function showUserInfo() {

    var avatar = currentUser['avatar_url'] ? currentUser['avatar_url'] : '/assets/main/avatar.png';

    $('#admin-panel .header').html('<div style="background: #fff; position: absolute; bottom: 15px; width: 100%;"><div style="padding: 10px 10px 10px 0; line-height: 1.5;"><img src="' + avatar + '" width="45" style="float: left; margin-right: 10px;">Welcome<br>' + currentUser['name'] + '</div></div>');

}

function createFavorite(userID, button) {

    if (currentUser.token !== null) {

        if (/active/.test(button.prop('class'))) { destroyFavorite(userID, button); }
        else {

            button.addClass('active');

            $.ajax({
                url: 'http://backend.liquidtalent.com/favourite/create?token=' + currentUser.token + '&demander_id=' + currentUser.id + '&provider_id=' + userID,
                error: Response
            }).done(function (user) {

                if (user.status === 'ok') { favorites[user.provider_id] = user.id; }

            });

        }

    }

}
function destroyFavorite(userID, button) {

        button.removeClass('active');

        $.ajax({
            url: 'http://backend.liquidtalent.com/favourite/destroy?token=' + currentUser.token + '&favourite_id=' + favorites[userID],
            error: Response
        }).done(function (user) {

            if (user.status === 'ok') { favorites.splice(indexOf(favorites[userID]), 1); }

        });

}
function getFavorites() {

    if (currentUser.token !== null) {

        $.ajax({
            url: 'http://backend.liquidtalent.com/favourites/list?token=' + currentUser.token + '&demander_id=' + currentUser.id,
            error: Response
        }).done(function (users) {

            favorites = [];
            users.response.forEach(function (user) { favorites[user.provider.id] = user.favourite_id; });

        });

    }

}

function filterUsers(callback) {
    $('#filter').hide();
    $('#content-preloader').show();

    $.ajax({
        url: 'http://backend.liquidtalent.com/users/filter',
        data: 'category_id=' + $('#category_id').val() +
              '&subcategory_id=' + $('#subcategory_id').val() +
              '&city_id=' + $('#subcategory_id').val() +
              '&hourly_rate_from=' + $('#hourly_rate_from').val() +
              '&hourly_rate_to=' + $('#hourly_rate_to').val() +
              '&rate_from=' + $('#rate_from').val() +
              '&rate_to=' + $('#rate_to').val() +
              '&school_id=' + $('#subcategory_id').val(),
        error: Response
    }).done(function (data) {
        $('#content-preloader').hide();
        users = data['response'];
        callback(users);
    });

    return false;
}

function prepareFilter() {
    $.ajax({
        url: 'http://backend.liquidtalent.com/get_info',
        error: function (error) {
            alert("Problem with connecting to the server");
            console.log(error);
        }
    }).done(function (data) {
        global_info = data['response'];

        data['response']['cities'].forEach(function (item) {
            $('#cities').append('<div onclick="setCity(' + item['id'] + ', \'' + item['name'] + '\');">' + item['name'] + '</div>')
        })

        data['response']['categories'].forEach(function (item) {
            $('#categories').append('<div onclick="setCategory(' + item['id'] + ', \'' + item['name'] + '\');">' + item['name'] + '</div>')
        })
    });

    $('.city').click(function () {
        if($('#cities').is(':visible')) {
            $('#cities').hide();
        }
        else {
            $('#cities').show();
        }
    });

    $('.category').click(function () {
        if($('#categories').is(':visible')) {
            $('#categories').hide();
        }
        else {
            $('#categories').show();
        }
    });

    $('.subcategory').click(function () {
        if($('#subcategories').is(':visible')) {
            $('#subcategories').hide();
        }
        else {
            $('#subcategories').show();
        }
    });

    if(filter_settings.subcategories.length > 0) {
        $('#subcategories').html('<div onclick="setSubcategory(null, \'All Subcategories\');">All Subcategories</div>');
    }

    filter_settings.subcategories.forEach(function (item) {
        $('#subcategories').append('<div onclick="setSubcategory(' + item.value + ', \'' + item.label + '\');">' + item.label + '</div>');
    });

    $( "#hourly_rate" ).slider({range: true, min: 0, max: 200, step: 20, values: [filter_settings.hourly_rate_from.value, filter_settings.hourly_rate_to.value],
        change: function( event, ui ) {
            var hourly_rate_values = $( "#hourly_rate" ).slider('values');
            $('#hourly_rate_from').val(hourly_rate_values[0]);
            $('#hourly_rate_to').val(hourly_rate_values[1]);

            filter_settings.hourly_rate_from.label = filter_settings.hourly_rate_from.value = hourly_rate_values[0];
            filter_settings.hourly_rate_to.label = filter_settings.hourly_rate_to.value = hourly_rate_values[1];
        },
        slide: function( event, ui ) {
            $('#hourly_rate_from_label').html(ui.values[0]);
            $('#hourly_rate_to_label').html(ui.values[1]);
        }
    });

    $( "#rate" ).slider({range: true, min: 0, max: 5, step: 1, values: [filter_settings.rate_from.value, filter_settings.rate_to.value],
        change: function( event, ui ) {
            var rate_values = $( "#rate" ).slider('values');
            $('#rate_from').val(rate_values[0]);
            $('#rate_to').val(rate_values[1]);

            filter_settings.rate_from.label = filter_settings.rate_from.value = rate_values[0];
            filter_settings.rate_to.label = filter_settings.rate_to.value = rate_values[1];
    },
        slide: function( event, ui ) {
            $('#rate_from_label').html(ui.values[0]);
            $('#rate_to_label').html(ui.values[1]);
        }
    });

    $('.category').val(filter_settings.category.label);
    $('.subcategory').val(filter_settings.subcategory.label);
    $('.city').val(filter_settings.city.label);
    $('.college').val(filter_settings.college.label);

    $('#category_id').val(filter_settings.category.value);
    $('#subcategory').val(filter_settings.subcategory.value);
    $('#city').val(filter_settings.city.value);
    $('#college').val(filter_settings.college.value);
    $('#hourly_rate_from').val(filter_settings.hourly_rate_from.value);
    $('#hourly_rate_to').val(filter_settings.hourly_rate_to.value);
    $('#rate_from').val(filter_settings.rate_from.value);
    $('#rate_to').val(filter_settings.rate_to.value);
}

function showPlaceholder (page) {

    if (currentUser === null) {

        $('#background').html(

            '<div id="placeholder">' +
                'Explore all of LiquidTalent.' +
                '<a href="javascript:loadPage(\'/login\')" class="green-button">Sign Up</a>' +
            '</div>'

        );

    }
    else {

        $('#background').html(

            '<div id="placeholder">' +
                'No ' + page + ' have been added here yet.' +
                '<a href="javascript:loadPage(\'/map\')" class="green-button">Find ' + page + '</a>' +
            '</div>'

        );

    }

}